@model WebZootecPro.ViewModels.AlimentacionRtm.FormulaEditVm
@{
    ViewData["Title"] = "Editar fórmula";
}

<h3 class="mb-3">Editar fórmula RTM</h3>

@if (TempData["msg"] != null)
{
    <div class="alert alert-warning">@TempData["msg"]</div>
}

<div class="row g-3">
    <div class="col-md-5">
        <form method="post" asp-action="FormulaActualizarCabecera" class="card card-body">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="Id" />

            <label class="form-label">Nombre</label>
            <input class="form-control" asp-for="nombre" />

            <label class="form-label mt-2">Descripción</label>
            <input class="form-control" asp-for="descripcion" />

            <div class="form-check mt-3">
                <input class="form-check-input" asp-for="activo" />
                <label class="form-check-label">Activo</label>
            </div>

            <div class="mt-3">
                <div class="text-muted small">Costo/kg (auto)</div>
                <div class="fs-5 fw-semibold">@((Model.costoKg?.ToString("0.0000")) ?? "-")</div>
                <div class="text-muted small">Total composición: @Model.porcentajeTotal.ToString("0.0000") %</div>
            </div>

            <div class="mt-3 d-flex gap-2">
                <button class="btn btn-primary" type="submit">Guardar cabecera</button>
                <a class="btn btn-outline-secondary" asp-action="Formulas">Volver</a>
            </div>
        </form>
    </div>

    <div class="col-md-7">
        <div class="card card-body mb-3">
            <h5 class="mb-2">Agregar ingrediente</h5>
            <form method="post" asp-action="FormulaAgregarDetalle" class="row g-2 align-items-end">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="Id" />

                <div class="col-md-6">
                    <label class="form-label">Ingrediente</label>
                    <select class="form-select" asp-for="ingredienteId" asp-items="ViewBag.IngredienteId">
                        <option value="">(seleccionar)</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">%</label>
                    <input class="form-control" asp-for="porcentaje" />
                </div>
                <div class="col-md-3">
                    <button class="btn btn-success w-100" type="submit">Agregar</button>
                </div>
            </form>
        </div>

        <table class="table table-sm table-striped align-middle">
            <thead>
                <tr>
                    <th>Ingrediente</th>
                    <th>%</th>
                    <th>Costo/kg</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var d in Model.detalles)
                {
                    <tr>
                        <td>@d.ingrediente</td>
                        <td>@d.porcentaje.ToString("0.0000")</td>
                        <td>@(d.costoKg?.ToString("0.0000") ?? "-")</td>
                        <td class="text-end">
                            <form method="post" asp-action="FormulaEliminarDetalle" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@d.Id" />
                                <input type="hidden" name="formulaId" value="@Model.Id" />
                                <button class="btn btn-sm btn-outline-danger" type="submit">Eliminar</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
